DIAGN√ìSTICO R√ÅPIDO - PERMISS√ïES BI
==================================

O PROBLEMA PODE ESTAR EM UM DESSES 4 LUGARES:

1. SALVAMENTO NO BANCO
   - Voc√™ seleciona dashboard no admin
   - Sistema tenta salvar no banco
   - MAS N√ÉO SALVA (fica NULL no banco)

2. CARREGAMENTO NA AUTENTICA√á√ÉO
   - Valores est√£o no banco
   - MAS quando user faz login, n√£o carrega
   - Ou carrega errado (vem como NULL)

3. ARMAZENAMENTO NO FRONTEND
   - Carrega na autentica√ß√£o
   - MAS frontend n√£o armazena
   - Session/storage fica vazio

4. FILTRAGEM DE DASHBOARDS
   - Tudo carrega corretamente
   - MAS frontend n√£o filtra baseado no valor
   - Mostra todos de qualquer forma


VAMOS DESCOBRIR QUAL √â
======================

PASSO 1 - Pega um user ID
--------------------------
No banco de dados, execute:
  SELECT id, usuario FROM user LIMIT 3;

Copia um ID (exemplo: 5)


PASSO 2 - Verifica o estado inicial
-------------------------------------
No terminal/Postman, execute:

curl http://localhost:8000/api/test/bi-check/5

Resposta esperada:
{
  "user_id": 5,
  "_bi_subcategories_raw": null,
  "_bi_subcategories_parsed": null
}

Se _bi_subcategories_raw for null = AINDA N√ÉO FOI SALVO NADA


PASSO 3 - For√ßa salvar permiss√µes
----------------------------------
Primeiro, descobre um dashboard_id real:

curl http://localhost:8000/api/powerbi/db/dashboards

Procura por um "dashboard_id" nessa resposta (exemplo: "abc123def456")

Depois, for√ßa salvar:

curl -X POST http://localhost:8000/api/test/bi-fix/5 \
  -H "Content-Type: application/json" \
  -d '{"dashboard_ids": ["abc123def456"]}'

Deve responder com "status": "ok"


PASSO 4 - Verifica se realmente salvou
---------------------------------------
Execute novamente:

curl http://localhost:8000/api/test/bi-check/5

Desta vez _bi_subcategories_raw deve ter um valor tipo:
"[\"abc123def456\"]"

- Se SIM = Problema √© no FRONTEND ou AUTENTICA√á√ÉO
- Se N√ÉO (ainda null) = Problema √© no SALVAMENTO


PASSO 5 - Se foi salvo, testa login
------------------------------------
1. Desloga de qualquer conta
2. Faz login COM ESSE USU√ÅRIO (ID 5 do exemplo)
3. Vai para Portal de BI
4. Abre o console do navegador (F12)

Procura por logs [BI] que mostrem:
- [BI] üîê Filtrando dashboards = EST√Å FILTRANDO
- [BI] üìö Usu√°rio sem restri√ß√µes = N√ÉO EST√Å FILTRANDO

Se aparecer "sem restri√ß√µes" = Problema est√° no FRONTEND (n√£o carregou ou n√£o armazenou)


RESULTADO
=========

Se passar no Passo 4 mas falhar no Passo 5:
‚Üí Problema est√° no FRONTEND/AUTENTICA√á√ÉO
‚Üí O valor est√° no banco mas n√£o est√° carregando no login

Se falhar no Passo 4:
‚Üí Problema est√° no SALVAMENTO
‚Üí O valor n√£o est√° sendo persistido no banco

Se passar em Passo 5 mas ver TODOS os dashboards:
‚Üí Problema est√° na FILTRAGEM
‚Üí O valor carrega mas frontend n√£o usa para filtrar


DEPOIS DO DIAGN√ìSTICO
====================

Voc√™ conseguir√° identificar EXATAMENTE qual √© o problema.
A√≠ posso corrigir o c√≥digo no local certo.
